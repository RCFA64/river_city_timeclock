{% extends "base.html" %}
{% block title %}Detailed Weekly Timecard: {{ loc.name }}{% endblock %}
{% block header %}Detailed Weekly Timecard: {{ loc.name }}{% endblock %}
{% block content %}
  <div class="mb-3">
    <!-- Location selector (reuse from report.html or skip if already on location) -->
    <form method="get" class="d-inline-block me-3">
      <label for="loc-select" class="form-label text-light me-2">Location:</label>
      <select id="loc-select" name="loc" onchange="this.form.submit()" class="form-select d-inline-block w-auto">
        {% for L in locations %}
          <option value="{{ L.id }}" {% if L.id==loc.id %}selected{% endif %}>
            {{ L.name }}
          </option>
        {% endfor %}
      </select>
      <input type="hidden" name="week_start" value="{{ selected_monday }}">
    </form>

    <!-- Week dropdown -->
    <form method="get" class="d-inline-block">
      <input type="hidden" name="loc" value="{{ loc.id }}">
      <label for="week-select" class="form-label text-light me-2">Week of:</label>
      <select id="week-select" name="week_start" onchange="this.form.submit()" class="form-select d-inline-block w-auto">
        {% for mon in mondays %}
          <option value="{{ mon }}" {% if mon == selected_monday %}selected{% endif %}>
            {{ mon.strftime('%b %-d, %Y') }}
          </option>
        {% endfor %}
      </select>
    </form>
  </div>

  <!-- Table: one row per employee, one column per date -->
  <table class="table table-bordered table-striped table-hover">
    <thead class="table-dark">
      <tr>
        <th>Employee</th>
        {% for d in dates %}
          <th class="text-center">
            {{ d.strftime('%a') }}<br />
            {{ d.strftime('%m/%d') }}
          </th>
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      {% for emp in report_data %}
        <tr>
          <td class="align-middle">{{ emp.employee_name }}</td>
          {% for d in dates %}
            <td>
              {% set events = emp.daily_events[d] %}
              {% if events %}
                <ul class="list-unstyled mb-0">
                  {% for ev_type, ev_dt in events %}
                    <li>
                      {% if ev_type == 'IN' %}
                        <span class="badge bg-success">IN</span>
                      {% else %}
                        <span class="badge bg-danger">OUT</span>
                      {% endif %}
                      {{ ev_dt.strftime('%-I:%M %p') }}
                    </li>
                  {% endfor %}
                </ul>
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </td>
          {% endfor %}
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="mt-4">
    <a href="{{ url_for('report', loc=loc.id) }}" class="btn btn-outline-light">
      ← Back to Summary
    </a>
  </div>
{% endblock %}

