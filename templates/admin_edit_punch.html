{% extends "base.html" %}
{% block title %}Admin • Edit Punch{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-start flex-wrap gap-2 mb-3">
  <div>
    <h2 class="fw-bold mb-1">Edit Punch</h2>
    <div class="text-secondary">
      Employee: <span class="fw-semibold">{{ employee.name }}</span>
      • Location: <span class="fw-semibold">{{ location.name }}</span>
    </div>
  </div>
  <div class="d-flex gap-2">
    <a class="btn btn-outline-light btn-sm" href="{{ url_for('admin_punches', loc=location.id) }}">Back to Punches</a>
    <a class="btn btn-outline-light btn-sm" href="{{ url_for('admin_audit') }}">Audit Log</a>
  </div>
</div>

<div class="card bg-dark border-light">
  <div class="card-body">
    <form method="post" class="row g-3">
      <div class="col-12 col-md-3">
        <label class="form-label text-secondary">Type</label>
        <select class="form-select" name="type" required>
          <option value="IN"  {% if punch.type == 'IN' %}selected{% endif %}>IN</option>
          <option value="OUT" {% if punch.type == 'OUT' %}selected{% endif %}>OUT</option>
        </select>
      </div>

      <div class="col-12 col-md-5">
        <label class="form-label text-secondary">Local Timestamp</label>
        <input class="form-control" type="datetime-local" name="timestamp" value="{{ local_value }}" required>
        <div class="text-secondary small mt-1">
          This is saved in UTC internally, but you edit in the location’s local time.
        </div>
      </div>

      <div class="col-12 col-md-4">
        <label class="form-label text-secondary">Audit Note (optional)</label>
        <input class="form-control" type="text" name="note" maxlength="500" placeholder="Reason for change (recommended)">
      </div>

      <div class="col-12 d-flex flex-wrap gap-2">
        <button class="btn btn-success fw-bold" type="submit">Save Changes</button>
        <a class="btn btn-outline-light" href="{{ url_for('admin_punches', loc=location.id) }}">Cancel</a>
      </div>
    </form>
    <form method="post"
          action="{{ url_for('admin_delete_punch', punch_id=punch.id) }}"
          class="mt-3"
          onsubmit="return confirm('DELETE this punch? This cannot be undone. An audit entry will be recorded.');">
      <div class="d-flex flex-wrap gap-2 align-items-end">
        <div style="flex:1; min-width:260px;">
          <label class="form-label text-secondary">Delete Note (recommended)</label>
          <input class="form-control" type="text" name="note" maxlength="500"
                 placeholder="Reason for deletion (ex: accidental extra punch)">
        </div>
        <button class="btn btn-danger fw-bold" type="submit">Delete Punch</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}